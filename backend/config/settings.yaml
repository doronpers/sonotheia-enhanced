# Sonotheia Enhanced Configuration
# Authentication policies and detection thresholds

# Demo mode - set to false in production
demo_mode: true

authentication_policy:
  minimum_factors: 2
  require_different_categories: true
  
  risk_thresholds:
    low:
      factors_required: 2
      max_amount_usd: 5000
    medium:
      factors_required: 2
      max_amount_usd: 25000
    high:
      factors_required: 3
      max_amount_usd: 100000

voice:
  deepfake_threshold: 0.3
  liveness_threshold: 0.3
  speaker_threshold: 0.85
  min_quality: 0.7
  model_path: backend/models/gmm_test.pkl
  sample_rate: 16000
  feature_types:
    - lfcc
    - logspec
  codec: landline
  target_fpr: 0.01

device:
  require_enrollment: true
  trust_score_threshold: 0.8

high_risk_countries:
  - "CN"
  - "RU"
  - "IR"
  - "KP"
  - "SY"
  - "AF"

# Sensor-specific thresholds (for human calibration)
sensors:
  glottal_inertia:
    min_rise_time_ms: 10.0        # Tissue inertia minimum
    silence_threshold_db: -60.0   # Below this = silence
    speech_threshold_db: -20.0    # Above this = speech
    min_decay_time_ms: 10.0       # Hard cut detection threshold
    phase_entropy_threshold: 0.0000 # Natural onset chaos threshold

  two_mouth:
    vtl_variance_threshold: 0.5   # VTL variance score threshold
    vtl_cv_low: 0.10              # Coefficient of variation: normal start
    vtl_cv_high: 0.20             # Coefficient of variation: suspicious end
    spectral_conflict_rate: 0.05  # Max % of frames with both-band conflict
    combined_threshold: 0.4033    # Overall pass/fail threshold (Calibration 2025-12-09)

  formant_trajectory:
    consistency_threshold: 0.7068 # Calibration 2025-12-09

  global_formants:
    outlier_threshold: 0.4017 # Calibration 2025-12-09

  coarticulation:
    anomaly_threshold: 0.5228 # Calibration 2025-12-09
    
  hf_deepfake:
    confidence_threshold: 0.70    # Calibration suggests 0.00, keeping safe default or use 0.0 only if strictly required

  breath:
    max_phonation_seconds: 1.3114 # Human lung capacity limit (Calibration result 1.76s rejected as too aggressive)
    silence_threshold_db: -60     # Silence detection
    frame_size_seconds: 0.02      # Analysis window

  dynamic_range:
    min_crest_factor: 7.6502 # Calibration 2025-12-09

  bandwidth:
    min_rolloff_hz: 4134.6778 # Context Detection Threshold

  pitch_velocity:
    max_velocity_threshold: 175.0 # Recalibrated 2025-12-10 (Organic P99: 174.28 st/s)
    min_voiced_duration: 0.05

  digital_silence:
    silence_threshold: 0.4056 # Calibration 2025-12-09

# Fusion weights (OVERRIDDEN BY PROFILES BELOW)
fusion:
  # Default Profile (Wideband/HD Audio)
  profiles:
    default:
      weights:
        GlottalInertiaSensor: 0.35
        PitchVelocitySensor: 0.15     # Replaces PhaseCoherence
        FormantTrajectorySensor: 0.20
        DigitalSilenceSensor: 0.15
        GlobalFormantSensor: 0.10
        CoarticulationSensor: 0.05
        HFDeepfakeSensor: 0.00
        TwoMouthSensor: 0.00          # Disabled
      thresholds:
        synthetic: 0.7
        real: 0.3

    # Narrowband Profile (Phone/VoIP Audio)
    # Triggered when BandwidthSensor detects < 4kHz rolloff
    # Strategy: TRUST PHYSICS, IGNORE SPECTRAL NOISE
    narrowband:
      weights:
        GlottalInertiaSensor: 0.50    # Higher trust in physics
        PitchVelocitySensor: 0.20     # Higher trust in laryngeal mechanics
        FormantTrajectorySensor: 0.20 # Reasonable robustness
        DigitalSilenceSensor: 0.10    # Less reliable on noisy lines
        GlobalFormantSensor: 0.00     # Un reliable on narrowband
        CoarticulationSensor: 0.00    # Likely to fail on compression
        HFDeepfakeSensor: 0.00
        TwoMouthSensor: 0.00
      thresholds:
        synthetic: 0.8  # Stricter threshold for Phone (Err on side of Real)
        real: 0.4

sar_detection_rules:
  structuring:
    enabled: true
    threshold_amount: 10000
    threshold_percentage: 0.95
    min_transactions: 3
  
  synthetic_voice:
    enabled: true
    threshold: 0.7
  
  high_value_high_risk:
    enabled: true
    amount_threshold: 50000